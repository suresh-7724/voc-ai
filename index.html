<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON File Upload</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
        integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Common styles */
        body {
            background-color: #f7f7f7;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        .file-upload {
            display: inline-block;
            padding: 10px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .text-container {
            margin-top: 20px;
        }

        .original {
            background-color: #c7e0ff;
            padding: 2px 5px;
            border-radius: 3px;
            margin-right: 3px;
        }

        .translated {
            color: black;
            font-style: italic;
        }

        .word-link {
            cursor: pointer;
            color: inherit;
            text-decoration: none;
        }

        .word-link:hover {
            text-decoration: underline;
        }

        .btn-container {
            margin-bottom: 10px;
        }

        .btn {
            padding: 5px 10px;
            margin-right: 10px;
            cursor: pointer;
        }

        audio {
            margin-bottom: 10px;
        }

        .rewind-section {
            position: sticky;
            top: 0;
            background-color: #f0f0f0;
            z-index: 1;
            padding: 10px 0;
        }

        .rewind-icons button {
            font-size: 18px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }

        h2 {
            margin-top: 0;
        }

        .tooltip {
            display: none;
            /* Initially hide the tooltip */
            position: fixed;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            z-index: 9999;
            max-width: 80%;
            /* Set maximum width */
            max-height: 80%;
            /* Set maximum height */
            overflow: auto;
            /* Enable scrolling if needed */
            font-size: 18px;
            /* Increase font size */
            line-height: 1.5;
            /* Increase line height for better readability */
            font-weight: bold;
            /* Use bold text */
            overflow-y: auto;
            /* Allow vertical scrolling */
        }

        .close-btn {
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 34px;
            /* Adjust size as needed */
            color: #ff0000;
            /* Red color */
        }

        .loader {
            display: none;
            border: 6px solid #f3f3f3;
            /* Light grey border */
            border-top: 6px solid #3498db;
            /* Blue border on top */
            border-radius: 50%;
            width: 80px;
            /* Increase the width */
            height: 80px;
            /* Increase the height */
            animation: spin 2s linear infinite;
            position: fixed;
            top: 50%;
            left: 50%;
            margin-top: -25px;
            /* Adjust margin to center vertically */
            margin-left: -25px;
            /* Adjust margin to center horizontally */
            z-index: 9999;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive styles */
        @media screen and (max-width: 600px) {

            /* Media query for smaller screens */
            .tooltip {
                max-width: 90%;
                /* Adjust maximum width for smaller screens */
                max-height: 70%;
                /* Adjust maximum height for smaller screens */
                padding: 10px;
                /* Adjust padding for smaller screens */
            }

            .container {
                padding: 10px;
            }

            .file-name {
                overflow-wrap: break-word;
                /* Wrap long file names */
                max-width: calc(100% - 120px);
                /* Limit the maximum width of the file name */
                display: inline-block;
                /* Ensure it behaves as a block element */
                margin-left: 10px;
                /* Add some margin for separation */
                white-space: normal;
                /* Allow wrapping */
            }

            .file-upload,
            .btn {
                margin-bottom: 5px;
            }
        }
    </style>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="loader" id="loader"></div>
        <!-- <div style="display: flex; align-items: center">
            <input type="file" id="audio-input" style="display: none" accept=".mp3,.wav" />
            <label for="audio-input" class="file-upload">Upload Audio File</label>
            <span class="file-name" id="audio-file-name"></span>
        </div>

        <div style="margin-top: 10px">
            <input type="file" id="file-input" style="display: none" accept=".json" />
            <label for="file-input" class="file-upload">Upload JSON File</label>
            <span class="file-name" id="file-name"></span>
        </div> -->
        <!-- <div class="btn-container">
            <button class="btn btn-info text-white" onclick="increaseTextSize()">
                Font Size <i class="fas fa-plus"></i>
            </button>
            <button class="btn btn-danger text-white" onclick="decreaseTextSize()">
                Font Size <i class="fas fa-minus"></i>
            </button>
        </div> -->
        <div class="rewind-section">
            <div class="row">
                <div class="col-md-6 row">
                    <div class="col-12 d-flex align-items-center flex-column player-layout">
                        <div class="col-12 d-flex justify-content-between">
                            <div class="col-11 d-flex justify-content-center align-items-center">
                                <h5 class="title ms-2 mb-0">Translated Results</h5>
                            </div>
                            <div class="col-1 d-flex justify-content-end align-items-center ">
                                <button type="button" class="btn m-0" data-bs-toggle="modal"
                                    data-bs-target="#exampleModal">
                                    <i class="fa-solid fa-gear"></i>
                                </button>
                                <div class="mx-2">

                                    <i id="open-saved-button" class="fa-solid fa-heart text-danger"
                                        data-bs-toggle="modal" data-bs-target="#wordPairModal"></i>
                                </div>

                            </div>
                        </div>
                        <audio controls id="audio-player" controlsList="nodownload noplaybackrate"></audio>
                        <div class="rewind-icons p-2">
                            <!-- <button onclick="rewindAudio(-5)"><i class="fa-solid fa-backward-fast"></i><i
                                    class="fa-solid fa-backward-step" style="margin-left: -3px;"></i></button> -->
                            <!-- <button onclick="rewindAudio(-10)"><i class="fa-solid fa-backward-fast"></i></button> -->
                            <button onclick="rewindAudio(-3)"> <i class="fa-solid fa-backward-step"></i></button>
                            <button onclick="rewindAudio(-3)"> <i class="fa-solid fa-backward"></i></button>
                            <button onclick="togglePlayPause()" id="play-pause-btn">
                                <i class="fa-regular fa-circle-play"></i>
                            </button>
                        </div>


                    </div>
                </div>


            </div>

        </div>
        <h2>Translated Results</h2>
        <div class="text-container" id="text-container">
            <!-- Text content will be added here dynamically -->
        </div>
    </div>
    <!-- <button>Show Popup</button> -->

    <!-- this is the pop code  -->
    <div class="cover" id="popup-text">
        <div class="contents">
            <h1 id="word-wrap"></h1>
            <span class="close"> <!-- close icon svg image code -->
                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30" height="30" viewBox="0 0 50 50">
                    <path
                        d="M 7.71875 6.28125 L 6.28125 7.71875 L 23.5625 25 L 6.28125 42.28125 L 7.71875 43.71875 L 25 26.4375 L 42.28125 43.71875 L 43.71875 42.28125 L 26.4375 25 L 43.71875 7.71875 L 42.28125 6.28125 L 25 23.5625 Z">
                    </path>
                </svg></span>

            <div class="more-example">
                <div class="content-details">
                    <div class="head-text">Literal translation:</div>
                    <div class="translate-text" id="literal_translate"></div>
                </div>

                <div class="content-details">
                    <div class="head-text">Example:</div>
                    <div class="spanish-text" id="example_translate"><strong id="example_translate_1">
                        </strong> <span id="example_translate_2"></span></div>
                </div>

                <div id="conjugation-div" class="content-details">
                    <div class="head-text">
                        Conjugations:
                        <div class="" id="conjugations_wrap">


                        </div>
                    </div>
                </div>

                <div class="content-details">
                    <div class="head-text">Word associations:</div>
                    <ul id="word_assc_translate">
                        <!-- <li>
                            <p>Think of a presenter on TV presenting the news.</p>
                        </li>
                        <li>
                            <p>Imagine yourself presenting a gift to someone.</p>
                        </li>
                        <li>
                            <p>Associate the word with a presentation you have done in the past.</p>
                        </li> -->
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-body">
                    <div class="row">

                        <div class="col-md-12">
                            <div class="col-12 row">

                                <div class="col-4">
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <label class="form-label mx-2  text-sm">
                                            <strong>
                                                Native
                                            </strong>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <label class="form-label mx-2  text-sm">
                                            <strong>

                                                Foreign
                                            </strong>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 row">
                                <div class="col-4">
                                    <label class="form-label mx-2 text-sm"> <strong>Audio:</strong></label>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" value="1"
                                                id="native_audio_switch" checked>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="foreign_audio_switch"
                                                checked>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 row">
                                <div class="col-4">
                                    <label class="form-label mx-2 text-sm"> <strong>Text:</strong></label>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="" checked>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="" checked>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 row">
                                <div class="col-4">
                                    <label class="form-label mx-2 text-sm"> <strong>Text size:</strong></label>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <select id="native_text_size" class="form-select  form-select-sm">
                                            <option value="10px">Very Small</option>
                                            <option value="12px">Small</option>
                                            <option selected value="16px">Medium</option>
                                            <option value="20px">Large</option>
                                            <option value="24px">Very Large</option>
                                            <option value="30px">Huge</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <select id="foreign_text_size" class="form-select  form-select-sm">
                                            <option value="10px">Very Small</option>
                                            <option value="12px">Small</option>
                                            <option selected value="16px">Medium</option>
                                            <option value="20px">Large</option>
                                            <option value="24px">Very Large</option>
                                            <option value="30px">Huge</option>
                                        </select>
                                    </div>
                                </div>


                            </div>
                            <div class="col-12 row">
                                <div class="col-4">
                                    <label class="form-label mx-2 text-sm"> <strong>Voice Speed:</strong></label>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <select id="native_audio_speed" class="form-select  form-select-sm">
                                            <option value="0.55">55%</option>
                                            <option value="0.70">70%</option>
                                            <option value="0.85">85%</option>
                                            <option selected value="1.00">100%</option>
                                            <option value="1.15">115%</option>
                                            <option value="1.30">130%</option>
                                            <option value="1.45">145%</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group mb-3 d-flex justify-content-center">
                                        <select id="foreign_audio_speed" class="form-select  form-select-sm">
                                            <option value="0.55">55%</option>
                                            <option value="0.70">70%</option>
                                            <option value="0.85">85%</option>
                                            <option selected value="1.00">100%</option>
                                            <option value="1.15">115%</option>
                                            <option value="1.30">130%</option>
                                            <option value="1.45">145%</option>
                                        </select>
                                    </div>
                                </div>


                            </div>
                            <div class="col-12 row">

                                <div class="col-12 col-md-5">
                                    <div class="form-group p-2">
                                        <label class="form-label mx-2  text-sm">
                                            Phrases Space
                                        </label>
                                        <select id="phrase_select" onchange="" class="form-select  form-select-sm">
                                            <option selected value="400">Slow</option>
                                            <option value="500">Very Slow</option>
                                            <option value="200">Fast</option>
                                            <option value="50">Very Fast</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-7 col-12">
                                    <div class="form-group p-2">
                                        <label class="form-label mx-2  text-sm">
                                            Double click sensitivity
                                        </label>
                                        <select class="form-select  form-select-sm">
                                            <option>Low (slow)</option>
                                            <option value="2">Medium</option>
                                            <option value="3">High</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 row">
                                <div class="col-md-5 col-12">
                                    <div class="form-group p-2">
                                        <label class="form-label   text-sm">
                                            Language Order
                                        </label>
                                        <select class="form-select  form-select-sm">
                                            <option value="3">Native First</option>
                                            <option value="1">Foreign First</option>
                                        </select>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button data-bs-dismiss="modal" type="button" class="btn btn-primary">Save </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="wordPairModal" tabindex="-1" aria-labelledby="wordPairModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="wordPairModalLabel">Saved Words</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="" class="modal-body">
                    <div class="row">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Word</th>
                                    <th scope="col">Native Word</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody id="saved_words_body">


                            </tbody>
                        </table>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js"
        integrity="sha512-ykZ1QQr0Jy/4ZkvKuqWn4iF3lqPZyij9iRv6sGqLRdTPkY69YX6+7wvVGmsdBbiIfN/8OdsI7HABjvEok6ZopQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        let audioResourceUrl = "https://voc-ai.vercel.app/jake";
        let foreignDir = "FR";
        let nativeDir = "EN";
        let currentAudioIndex = 1;
        let currentDir = foreignDir;
        let textSize = 16; // Initial text size
        let audioStopped = false;
        let audioPlayer = document.getElementById("audio-player");
        let nativeAudioPlay = true;
        let foreignAudioPlay = true;
        let phrase_speed = 400;
        let native_phrase_speed = 400;
        let nativeAudioSpeed = 1;
        let foreignAudioSpeed = 1;
        let doubleClickDelay = 250; // Adjust as needed

        // load the audio player
        $(document).ready(function () {

            loadAudioPlayer();
            audioPlayer.addEventListener("ended", function () {
                setTimeout(() => {
                    var element = $('.highlight');
                    var yPos = element.offset().top;

                    var windowHeight = $(window).height();

                    // Calculate the scroll position to center the element vertically
                    var newScrollTop = yPos - (windowHeight / 2) + (element.outerHeight() / 2) - 200;

                    // Animate scrolling to the new position
                    if (currentDir == nativeDir) {
                        $('html, body').animate({
                            scrollTop: newScrollTop
                        }, 100);
                    }

                    loadPlayerSettings()
                    loadAudioPlayer()
                    $(".original_para").removeClass("highlight");
                    $(".translated_para").removeClass("highlight");
                    if (currentDir == nativeDir) {
                        $(".translated_para").eq([currentAudioIndex - 1]).addClass("highlight")

                        audioPlayer.playbackRate = nativeAudioSpeed
                    } else if (currentDir == foreignDir) {
                        $(".original_para").eq(currentAudioIndex - 1).addClass("highlight");
                        audioPlayer.playbackRate = foreignAudioSpeed
                    }
                    audioPlayer.play()

                }, phrase_speed);
                // loadAudioPlayer()
            })
            $("#open-saved-button").click(function () {
                showSavedWordsTable();
            })

        })
        function highlightSavedWords() {
            let sessionJson = sessionStorage.getItem("saved_list");

            // Check if sessionStorage has "saved_list" item
            if (!sessionJson) {
                // If not there, create an empty array and store it
                sessionJson = "[]";
                sessionStorage.setItem("saved_list", sessionJson);
            }

            sessionJson = JSON.parse(sessionJson);
            sessionJson.forEach(element => {
                if (element == null) return;
                
                var nativePara = $('[data-id="' + element.dataParentId + '"][data-type="O"]');
                
                var children = $(nativePara).find('[data-word-id="' + element.dataId + '"][data-word-type="O"]').addClass("saved");

            });
        }
        function removeSaved(index) {
            let sessionJson = sessionStorage.getItem("saved_list");
            sessionJson = JSON.parse(sessionJson);
            sessionJson.splice(index - 1, 1);

            sessionJson = JSON.stringify(sessionJson);
            sessionStorage.setItem("saved_list", sessionJson);
            showSavedWordsTable()
            $("span").removeClass("saved")
            highlightSavedWords()
        }
        function showSavedWordsTable() {

            let sessionJson = sessionStorage.getItem("saved_list");

            // Check if sessionStorage has "saved_list" item
            if (!sessionJson) {
                // If not there, create an empty array and store it
                sessionJson = "[]";
                sessionStorage.setItem("saved_list", sessionJson);
            }

            sessionJson = JSON.parse(sessionJson);
            let i = 1;
            let trElem = "";
            sessionJson.forEach(element => {
                if (element == null) return;
                trElem += `<tr>
                                    <th scope="row">${i}</th>
                                    <td>${element?.word}</td>
                                    <td>${element?.nativeWord}</td>
                                    <td><a onclick="removeSaved(${i})" href="javascript:void(0)">Remove</a></td>
                                </tr>
                                `
                i++;
            });
            $("#saved_words_body").html(trElem)
        }
        $("#native_text_size").change(() => {
            $(".original_para").css("font-size", $("#native_text_size").val());
        })
        $("#foreign_text_size").change(() => {

            $(".translated_para").css("font-size", $("#foreign_text_size").val());
        })
        function keepHighlightVisible() {
            const element = document.querySelector('.highlight'); // Get the element with the "highlight" class

            if (element) {
                const scrollPosition = window.scrollY || window.pageYOffset; // Get current scroll position
                const elementBottom = element.offsetTop + element.offsetHeight; // Calculate element's bottom position
                const windowHeight = window.innerHeight; // Get window height

                // Check if the element is near the bottom of the viewport
                if (elementBottom - scrollPosition < windowHeight) {
                    // Element is not at the bottom, so do nothing
                    return;
                }

                // Element is at the bottom, scroll to keep it visible
                window.scrollTo(0, elementBottom - windowHeight);
            }
        }
        $("#phrase_select").change(function () {
            phrase_speed = parseInt($("#phrase_select").val())

        })
        $("#foreign_audio_speed").change(function () {
            foreignAudioSpeed = parseFloat($("#foreign_audio_speed").val());


        })
        $("#native_audio_speed").change(function () {
            nativeAudioSpeed = parseFloat($("#native_audio_speed").val());

        })
        function loadAudioPlayer() {
            let audioUrl = audioResourceUrl + "/" + currentDir + "/" + currentAudioIndex + ".wav";
            
            audioPlayer.src = audioUrl;

        }
        function loadPlayerSettings() {
            if (currentDir == nativeDir) {
                currentAudioIndex++;
                currentDir = foreignDir
                if (!foreignAudioPlay) {
                    muteAudio();
                } else {
                    unMuteAudio();

                }
            } else if (currentDir == foreignDir) {
                currentDir = nativeDir
                if (!nativeAudioPlay) {
                    muteAudio();
                } else {

                    unMuteAudio();
                }
            }
            console.log(currentDir);

        }
        function muteAudio() {
            audioPlayer.muted = true;
        }
        function unMuteAudio() {
            audioPlayer.muted = false;
        }
        function playAudio() {
            audioPlayer.play()
        }
        $("#native_audio_switch").click(() => {
            if (nativeAudioPlay == true) {
                nativeAudioPlay = false
            } else if (nativeAudioPlay == false) {
                nativeAudioPlay = true;
            }
            loadPlayerSettings()

        });
        $("#foreign_audio_switch").click(() => {
            if (foreignAudioPlay == true) {
                foreignAudioPlay = false
            } else if (foreignAudioPlay == false) {
                foreignAudioPlay = true;
            }
            loadPlayerSettings()

        });

        // $(".word-link").dblclick(()=>{
        //     console.log('double inn');

        // })
        // document
        //     .getElementById("audio-input")
        //     .addEventListener("change", function (event) {
        //         const file = event.target.files[0];
        //         if (file) {
        //             document.getElementById("audio-file-name").textContent = file.name;
        //             const audioPlayer = document.getElementById("audio-player");
        //             audioPlayer.src = URL.createObjectURL(file);
        //         }
        //     });

        // document
        //     .getElementById("file-input")
        //     .addEventListener("change", function (event) {
        //         const file = event.target.files[0];
        //         if (file) {
        //             document.getElementById("file-name").textContent = file.name;
        //             const reader = new FileReader();
        //             reader.onload = function (e) {
        //                 const content = e.target.result;
        //                 try {
        //                     const data = JSON.parse(content);
        //                     processData(data);
        //                 } catch (error) {
        //                     console.error("Error parsing JSON:", error);
        //                 }
        //             };
        //             reader.readAsText(file);
        //         }
        //     });
        function processData(data) {
            let translations = [];

            // Check if data is in the first format
            if ("output" in data) {
                translations = data.output.map((item) => ({
                    Original: item.Original,
                    Translated: item.Translated,
                }));
            }
            // Check if data is in the second format
            else if ("record" in data && "output" in data.record) {
                translations = data.record.output.map((item) => ({
                    Original: item.Original,
                    Translated: item.Translated,
                }));
            }
            // Unsupported JSON format
            else {
                console.error("Unsupported JSON format:", data);
                return;
            }

            displayText(translations);
        }

        function displayText(output) {
            const container = document.getElementById("text-container");
            container.innerHTML = "";
            let isFirstOriginal = true;
            let index = 0;
            output.forEach((item) => {
                const originalText = item.Original;
                const translatedText = item.Translated;


                const originalParagraph = document.createElement("p");
                const translatedParagraph = document.createElement("p");
                originalParagraph.setAttribute("data-type", "O")
                originalParagraph.setAttribute("data-id", index)
                translatedParagraph.setAttribute("data-type", "T")
                translatedParagraph.setAttribute("data-id", index)
                originalParagraph.classList.add("original_para");
                translatedParagraph.classList.add("translated_para");
                const originalWords = originalText.split(" ");
                const translatedWords = translatedText.split(" ");

                let wordIndex = 0;
                originalWords.forEach((word) => {
                    const span = document.createElement("span");
                    span.textContent = word;
                    span.classList.add("original", "word-link", "word-click");

                    span.setAttribute("data-word-id", wordIndex)
                    span.setAttribute("data-word-type", "O")
                    // span.addEventListener("click", handleWordSelection);

                    originalParagraph.appendChild(span);
                    originalParagraph.appendChild(document.createTextNode(" "));
                    wordIndex++;
                });

                if (!isFirstOriginal) {
                    container.appendChild(document.createElement("br")); // Add line gap between translations
                } else {
                    isFirstOriginal = false;
                }


                wordIndex = 0;

                translatedWords.forEach((word) => {
                    const span = document.createElement("span");
                    span.textContent = word;
                    span.classList.add("translated", "word-link");
                    span.setAttribute("data-word-id", wordIndex)
                    span.setAttribute("data-word-type", "T")
                    // span.addEventListener("click", handleWordSelection);
                    translatedParagraph.appendChild(span);
                    translatedParagraph.appendChild(document.createTextNode(" "));
                    wordIndex++;

                });

                container.appendChild(originalParagraph);
                container.appendChild(translatedParagraph);
                $(".original_para").eq(0).addClass("highlight");
                index++;

            });

            var wordElement = $('.word-click');
            var singleClickTimer;

            wordElement.on('click', function (event) {
                if (!singleClickTimer) {
                    singleClickTimer = setTimeout(function () {
                        // Single click action
                        addTofavorite(event)
                        singleClickTimer = null;
                    }, doubleClickDelay);
                } else {
                    // Prevent single click action
                    clearTimeout(singleClickTimer);
                    singleClickTimer = null;
                    // Double click action
                    handleWordSelection(event)
                }
            });
            highlightSavedWords()

        }

        window.onload = function () {
            const urlParams = new URLSearchParams(window.location.search);
            const jsonUrl = urlParams.get("json");
            // const audioUrl = urlParams.get("audio");
            // const audioUrl = "http://localhost/jake/EN/Jake%20Peral_0-EN-1-120-500-V25-25.wav";

            console.log("JSON URL:", jsonUrl);
            // console.log("Audio URL:", audioUrl);

            if (jsonUrl) {
                fetchAndDisplayJson(jsonUrl);
            } else {
                console.log("No JSON URL provided.");
            }

            // if (audioUrl) {
            //     document.getElementById("audio-file-name").textContent = audioUrl;
            //     document.getElementById("audio-player").src = audioUrl;
            //     console.log("Audio URL provided:", audioUrl);
            // } else {
            //     console.log("No Audio URL provided.");
            // }
        };

        function fetchAndDisplayJson(jsonUrl) {
            console.log("Fetching JSON from:", jsonUrl);
            fetch(jsonUrl)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then((data) => {
                    // Process the JSON data
                    displayText(data.record.output);
                })
                .catch((error) => {
                    console.error("Error loading JSON from URL:", error);
                });
        }

        function openGoogleSearch(word) {
            const searchUrl =
                "https://www.google.com/search?q=" + encodeURIComponent(word);
            window.open(searchUrl, "_blank");
        }

        function increaseTextSize() {
            textSize += 2;
            document.getElementById("text-container").style.fontSize =
                document.getElementById("popup-text").style.fontSize =
                textSize + "px";
        }

        function decreaseTextSize() {
            if (textSize > 10) {
                // test
                textSize -= 2;
                document.getElementById("text-container").style.fontSize =
                    document.getElementById("popup-text").style.fontSize =
                    textSize + "px";
            }
        }

        function rewindAudio(seconds) {
            const audioPlayer = document.getElementById("audio-player");
            audioPlayer.currentTime += seconds;
        }
        function togglePlayPause() {

            const audioPlayer = document.getElementById("audio-player");
            const playPauseBtn = document.getElementById("play-pause-btn");

            if (audioPlayer.paused || audioPlayer.ended) {
                loadAudioPlayer()
                audioPlayer.play();
                playPauseBtn.innerHTML = '<i class="fa-solid fa-pause"></i>'; // Pause symbol
                audioStopped = false;
            } else {
                audioPlayer.pause();
                playPauseBtn.innerHTML = '<i class="fa-regular fa-circle-play"></i>'; // Play symbol
                audioStopped = false;
            }
        }
        // Function to handle double-click event on words
        // function handleWordSelection(event) {
        //     const Word = event.target.textContent.trim();

        //     if (Word) {
        //         // Since getHoveredResult is async, use .then() to wait for the promise to resolve
        //         getHoveredResult(Word)
        //             .then((hoveredResult) => {


        //                 showHoveredResult(event.clientX, event.clientY, hoveredResult);
        //             })
        //             .catch((error) => {
        //                 console.error("Failed to get hovered result:", error);
        //                 // Optionally, handle the error, e.g., by showing an error message to the user
        //             });
        //     }
        // }
        async function getHoveredResult(word) {
            try {
                const myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");

                const raw = JSON.stringify({ word }); // Destructuring assignment for cleaner syntax

                const requestOptions = {
                    method: "POST",
                    headers: myHeaders,
                    body: raw,
                    redirect: "follow",
                };

                const response = await fetch("https://voc-ai-server.onrender.com/translate", requestOptions);
                const data = await response.json();

                if (data.choices && data.choices.length > 0) {
                    let content = data.choices[0].message.content;
                    // Add newline character after each numbered line

                    return content;
                }
            } catch (error) {
                console.error(error);
            }
        }
        // async function getHoveredResult(Word) {



        //     const myHeaders = new Headers();
        //     myHeaders.append("Content-Type", "application/json");
        //     myHeaders.append("Accept", "application/json");
        //     myHeaders.append(
        //         "Authorization",
        //         "Bearer sk-proj-ZEUmeKUDmZ8JSC5SEVb2T3BlbkFJDguqKfw6KmucFqzzIeOV"
        //     );

        //     const raw = JSON.stringify({
        //         model: "gpt-3.5-turbo",
        //         messages: [
        //             {
        //                 role: "user",
        //                 content:
        //                     "you are an expert linguist and tutor of languages. We want to help english speakers learn foriegn words. I'll provide a foriegn word, and context and you provide me with the following:\n1. Literal translation of that word. If the translation within the context is different than the literal translation then add that as well. No more than 50 charachters.\n2. example for using this word in a sentence. no more than 50 charachters.\n3. If the word is a verb, conjugations for all relevant aspects \n4. three suggestions how an English speaker should memorize that word using word associaltions. response json , use memorization_tips as a key only,Given Word: " +
        //                     Word,
        //             },
        //         ],
        //         temperature: 1,
        //         top_p: 1,
        //         n: 1,
        //         stream: false,
        //         max_tokens: 250,
        //         presence_penalty: 0,
        //         frequency_penalty: 0,
        //     });

        //     const requestOptions = {
        //         method: "POST",
        //         headers: myHeaders,
        //         body: raw,
        //         redirect: "follow",
        //     };

        //     try {
        //         const response = await fetch(
        //             "https://api.openai.com/v1/chat/completions",
        //             requestOptions
        //         );
        //         const data = await response.json();
        //         if (data.choices && data.choices.length > 0) {
        //             let content = data.choices[0].message.content;
        //             // Add newline character after each numbered line

        //             console.log(content); // Logging the modified content to the console
        //             return content; // Return the modified content
        //         } else {
        //             // Handle the case where no choices are returned
        //             console.log("No choices available in the response");
        //             return "No response received.";
        //         }
        //     } catch (error) {
        //         console.error(error);
        //         return `Error: ${error}`; // Return error information for debugging
        //     }
        // }
        // // Function to remove the tooltip
        function removeTooltip() {
            const tooltip = document.getElementById("tooltip");
            if (tooltip) {
                tooltip.parentNode.removeChild(tooltip);
            }
        }

        function showHoveredResult(x, y, hoveredResult) {

            if (window.scrollY < 150) {

                window.scrollBy(0, 210);
            }
            // Clean up each part

            // Remove the empty first element

            // Output the separated parts
            // parts.forEach((element, index) => {
            //     parts[index].replace("Literal translation:", "")
            //     parts[index].replace("Example:", "")
            //     parts[index].replace("Conjugations: ", "")
            //     parts[index].replace("Word associations:", "")
            // });
            let result = JSON.parse(hoveredResult)
            console.log(result);

            $("#literal_translate").html(result.literal_translation)
            $("#example_translate").html(result.example_sentence)
            let tipsHtml = "";
            result.memorization_tips.forEach(function (tip) {
                tipsHtml += '<li><p>' + tip + '</p></li>'
            });



            $("#word_assc_translate").html(tipsHtml)

            let conjugationsHtml = "";
            let i = 0;
            for (var person in result.conjugations) {
                if (result.conjugations.hasOwnProperty(person)) {
                    i++;
                    conjugationsHtml += `<div class="spanish-text"><b> <span >${person}</span></b><span style="color:#000";  >${result.conjugations[person]}</span></div>`
                }
            }
            if (i > 0) {
                $("#conjugation-div").show()
            } else {
                $("#conjugation-div").hide()

            }
            $("#conjugations_wrap").html(conjugationsHtml)
            $(".cover").fadeIn("300");
            document.body.style.overflow = 'hidden';

            $(".cover,.close").click(function () {
                $(".cover").fadeOut("300");
                document.body.style.overflow = 'auto';
                const audioPlayer = document.getElementById("audio-player");
                const wasAudioPaused = audioPlayer.paused;

                // Remove the tooltip

                // If the audio was paused before opening the tooltip, resume playing it
                if (wasAudioPaused && audioStopped) {
                    audioPlayer.play();
                }
            })
            $(".contents").click(function (e) {
                e.stopPropagation();
            })


            return;
            // Remove the previous tooltip if it exists
            // removeTooltip();

            // // Create a new tooltip element
            // const tooltip = document.createElement("div");
            // tooltip.innerHTML = `<span class="close-btn" onclick="closeTooltip()">Ã—</span>${hoveredResult.replace(
            //     /\n/g,
            //     "<br>"
            // )}`;
            // tooltip.classList.add("tooltip");
            // tooltip.id = "tooltip"; // Set an id for easy access
            // tooltip.classList.add("tooltip"); // Add tooltip class
            // tooltip.style.position = "fixed";
            // tooltip.style.top = y - tooltip.offsetHeight - 5 + "px";
            // tooltip.style.left = x + "px";
            // tooltip.style.width = "80%"; // Set width
            // tooltip.style.height = "80vh"; // Set height (80% of viewport height)
            // tooltip.style.backgroundColor = "rgba(255, 255, 255, 0.9)";
            // tooltip.style.padding = "5px";
            // tooltip.style.border = "1px solid #ccc";
            // tooltip.style.borderRadius = "5px";
            // tooltip.style.zIndex = "9999";
            // tooltip.style.maxHeight = "200px"; // Limit the maximum height
            // tooltip.style.overflowY = "auto"; // Enable vertical scrolling

            // // Append the tooltip to the body
            // document.body.appendChild(tooltip);

            // // Show the tooltip
            // tooltip.style.display = "block";

            // // Adjust the position of the tooltip to ensure it stays within the bounds of the .container div
            // const tooltipWidth = tooltip.offsetWidth;
            // const tooltipHeight = tooltip.offsetHeight;
            // const containerRect = document
            //     .querySelector(".container")
            //     .getBoundingClientRect();
            // const containerLeft = containerRect.left;
            // const containerRight = containerRect.right;

            // // Calculate the position of the tooltip relative to the clicked word
            // let tooltipX = x - tooltipWidth / 2;
            // let tooltipY = y - tooltipHeight / 2;

            // // Ensure the tooltip stays within the boundaries of the .container div
            // if (tooltipX < containerLeft) {
            //     tooltipX = containerLeft;
            // } else if (tooltipX + tooltipWidth > containerRight) {
            //     tooltipX = containerRight - tooltipWidth;
            // }

            // // Set the tooltip position
            // tooltip.style.left = `${tooltipX}px`;
            // tooltip.style.top = `${tooltipY}px`;

            // // Check if the tooltip content exceeds its height and add scrollbar if needed
            // if (tooltip.scrollHeight > tooltip.clientHeight) {
            //     tooltip.style.overflowY = "auto";
            // }

            // // Add event listener to remove the tooltip when clicking anywhere on the page
            // document.addEventListener("click", removeTooltipOnClick);
        }

        function removeTooltipOnClick(event) {
            const tooltip = document.getElementById("tooltip");
            if (tooltip && event.target !== tooltip) {
                // Check if the audio was paused before opening the tooltip
                const audioPlayer = document.getElementById("audio-player");
                const wasAudioPaused = audioPlayer.paused;

                // Remove the tooltip
                removeTooltip();

                // If the audio was paused before opening the tooltip, resume playing it
                if (wasAudioPaused) {
                    audioPlayer.play();
                }

                document.removeEventListener("click", removeTooltipOnClick);
            }
        }
        // Function to close the tooltip
        function closeTooltip() {
            // Check if the audio was paused before opening the tooltip
            const audioPlayer = document.getElementById("audio-player");
            const wasAudioPaused = audioPlayer.paused;

            // Remove the tooltip
            removeTooltip();

            // If the audio was paused before opening the tooltip, resume playing it
            if (wasAudioPaused) {
                audioPlayer.play();
            }
        }

        // Function to resume the audio if it was playing before (optional)
        function resumeAudio() {
            const audioPlayer = document.getElementById("audio-player");
            if (!audioPlayer.paused) {
                audioPlayer.play();
            }
        }
        function addTofavorite(event) {
            let word = event.target.textContent.trim();
            let dataId = $(event.target).attr("data-word-id");
            let parentDataId = $(event.target).parent().attr("data-id");
            let dataType = $(event.target).attr("data-type");
            var nativePara = $('[data-id="' + parentDataId + '"][data-type="T"]');
            var children = $(nativePara).find('[data-word-id="' + dataId + '"][data-word-type="T"]').text();
            storeWords(word, children, dataId, parentDataId)
            $(event.target).addClass("saved")
            $(event.target).after('<i class="fa-solid fa-heart text-danger"  id=' + dataId + dataType + ' ></i>');
            setTimeout(() => {
                $("#" + dataId + dataType).remove()
            }, 1000);
        }
        function storeWords(word, nativeWord, dataId, dataParentId) {
            let wordJson = {  // Assuming wordJson represents a single object
                word: word,
                nativeWord: nativeWord,
                dataId: dataId,
                dataParentId: dataParentId
            };

            let sessionJson = sessionStorage.getItem("saved_list");

            // Check if sessionStorage has "saved_list" item
            if (!sessionJson) {
                // If not there, create an empty array and store it
                sessionJson = "[]";
                sessionStorage.setItem("saved_list", sessionJson);
            }

            sessionJson = JSON.parse(sessionJson);

            function isUnique(obj, existingList) {
                // Custom comparison to check for objects with same properties and values
                for (const item of existingList) {
                    if (Object.keys(obj).every(key => obj[key] === item[key])) {
                        return false; // Not unique if all properties match
                    }
                }
                return true; // Unique if no matches found
            }

            const isNewWordUnique = isUnique(wordJson, sessionJson);

            if (isNewWordUnique) {
                sessionJson.push(wordJson);  // Add wordJson to sessionJson if unique
                sessionStorage.setItem("saved_list", JSON.stringify(sessionJson));  // Update storage
            }


        }
        async function handleWordSelection(event) {
            // Pause the audio if it's playing
            pauseAudio();

            const Word = event.target.textContent.trim();

            // Show the loader
            const loader = document.getElementById("loader");
            loader.style.display = "block";

            if (Word) {
                try {
                    // Since getHoveredResult is async, use await to wait for the promise to resolve
                    const hoveredResult = await getHoveredResult(Word);
                    $("#word-wrap").text(Word)
                    showHoveredResult(event.clientX, event.clientY, hoveredResult);
                } catch (error) {
                    // Optionally, handle the error, e.g., by showing an error message to the user
                } finally {
                    // Hide the loader once the content is received or an error occurs
                    loader.style.display = "none";
                }
            }
        }

        // Function to pause the audio if it's playing
        function pauseAudio() {
            const audioPlayer = document.getElementById("audio-player");
            if (!audioPlayer.paused) {
                audioStopped = true;
                audioPlayer.pause();
            }
        }
    </script>

</body>

</html>